<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" class="light" lang="es">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title th:text="${product.name} + ' - Detodoya'">Detodoya - Detalle de Producto</title>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#137fec",
                        "primary-dark": "#0b63be", 
                        "background-light": "#f8f9fa",
                        "background-dark": "#101922",
                        "surface-light": "#ffffff",
                        "surface-dark": "#1a2632",
                    },
                    fontFamily: {
                        "sans": ["Inter", "sans-serif"],
                        "display": ["Inter", "sans-serif"]
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                    }
                },
            },
        }
    </script>
    <style>
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        html {
            scroll-behavior: smooth;
        }
        
        /* Estilos mejorados para el modal */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.85) !important;
            backdrop-filter: blur(4px);
        }
        
        .modal-content {
            box-shadow: none;
        }
        
        .modal-media {
            transition: all 0.3s ease;
        }
        
        .modal-media:hover {
            transform: scale(1.02);
        }
        
        .modal-nav-btn {
            backdrop-filter: blur(10px);
        }
        
        .modal-nav-btn:hover {
            background: rgba(0,0,0,0.8) !important;
        }
        
        .modal-indicator {
            transition: all 0.3s ease;
        }
        
        .modal-indicator:hover {
            background: rgba(255,255,255,0.8) !important;
            transform: scale(1.2);
        }
        
        .modal-indicator.active {
            transform: scale(1.3);
        }
        
        /* Responsive: Modal mejorado en móvil */
        @media (max-width: 768px) {
            .modal-dialog {
                margin: 0;
                max-width: 100%;
                height: 100vh;
            }
            
            .modal-content {
                height: 100vh;
                border-radius: 0;
            }
            
            .modal-body {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .modal-nav-btn {
                width: 45px !important;
                height: 45px !important;
                font-size: 20px !important;
            }
            
            .modal-media {
                max-height: 85vh !important;
            }
        }
        
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-sans antialiased text-slate-800 dark:text-gray-100 min-h-screen flex flex-col selection:bg-primary/20 selection:text-primary">
    
    <!-- Header -->
    <header class="sticky top-0 z-50 bg-surface-light/90 dark:bg-surface-dark/90 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 w-full transition-colors duration-300">
        <div class="px-4 md:px-8 py-3 flex items-center justify-between max-w-7xl mx-auto h-16">
            <div class="flex items-center gap-8">
                <a class="flex items-center gap-3 text-slate-900 dark:text-white group" th:href="@{/}">
                    <div class="size-9 bg-primary rounded-xl flex items-center justify-center text-white shadow-lg shadow-primary/30 group-hover:scale-105 transition-transform">
                        <span class="material-symbols-outlined text-[20px]">shopping_bag</span>
                    </div>
                    <h2 class="text-xl font-bold tracking-tight group-hover:text-primary transition-colors">Detodoya</h2>
                </a>
                <nav class="hidden lg:flex items-center gap-8">
                    <a class="text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-primary dark:hover:text-white transition-colors" th:href="@{/}">Inicio</a>
                    <a class="text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-primary dark:hover:text-white transition-colors" th:href="@{/catalog}">Catálogo</a>
                    <a class="text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-primary dark:hover:text-white transition-colors" href="#">Categorías</a>
                    <a class="text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-primary dark:hover:text-white transition-colors" th:href="@{/contact}">Contacto</a>
                </nav>
            </div>
            <div class="flex flex-1 justify-end gap-3 md:gap-6 items-center">
                <label class="hidden md:flex flex-col min-w-40 h-10 max-w-xs w-full">
                    <div class="flex w-full flex-1 items-stretch rounded-full h-full bg-slate-100 dark:bg-slate-800 overflow-hidden focus-within:ring-2 ring-primary/30 border border-transparent focus-within:border-primary/50 transition-all">
                        <div class="text-slate-500 flex items-center justify-center pl-4">
                            <span class="material-symbols-outlined text-[20px]">search</span>
                        </div>
                        <input class="w-full bg-transparent border-none focus:ring-0 text-sm px-3 text-slate-900 dark:text-white placeholder:text-slate-400 font-medium" placeholder="Buscar productos..."/>
                    </div>
                </label>
                <div class="flex gap-1">
                    <button class="flex items-center justify-center size-10 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors relative text-slate-700 dark:text-slate-300">
                        <span class="material-symbols-outlined text-[24px]">shopping_cart</span>
                        <span class="absolute top-2 right-2 size-2 bg-red-500 rounded-full ring-2 ring-white dark:ring-surface-dark"></span>
                    </button>
                    <button class="flex items-center justify-center size-10 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors text-slate-700 dark:text-slate-300">
                        <span class="material-symbols-outlined text-[24px]">account_circle</span>
                    </button>
                    <button class="md:hidden flex items-center justify-center size-10 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors text-slate-700 dark:text-slate-300">
                        <span class="material-symbols-outlined text-[24px]">menu</span>
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <main class="flex-grow w-full max-w-7xl mx-auto px-4 md:px-8 py-8">
        <!-- Breadcrumb -->
        <nav aria-label="Breadcrumb" class="mb-8">
            <ol class="flex flex-wrap gap-2 items-center text-sm text-slate-500 dark:text-slate-400">
                <li><a class="hover:text-primary transition-colors hover:underline" th:href="@{/}">Inicio</a></li>
                <li><span class="material-symbols-outlined text-[14px] text-slate-400">chevron_right</span></li>
                <li th:if="${product.categories != null and !product.categories.isEmpty()}">
                    <a class="hover:text-primary transition-colors hover:underline" th:href="@{/catalog(category=${product.categories[0].name})}" th:text="${product.categories[0].name}">Categoría</a>
                </li>
                <li th:if="${product.categories != null and !product.categories.isEmpty()}"><span class="material-symbols-outlined text-[14px] text-slate-400">chevron_right</span></li>
                <li><span aria-current="page" class="text-slate-900 dark:text-white font-semibold" th:text="${product.name}">Nombre del Producto</span></li>
            </ol>
        </nav>
        
        <!-- Product Section -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-10 lg:gap-16 mb-20">
            <!-- Image Gallery -->
            <div class="lg:col-span-7 flex flex-col gap-6">
                <!-- Main Image Container -->
                <div class="aspect-[4/3] w-full bg-white dark:bg-surface-dark rounded-3xl overflow-hidden border border-slate-100 dark:border-slate-800 shadow-soft relative group cursor-pointer" id="mainImageContainer" data-bs-toggle="modal" data-bs-target="#imageModal">
                    <i class="bi bi-image" th:if="${product.images == null or product.images.isEmpty()}" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 4rem; color: #ccc;"></i>
                    <!-- Calcular si es video usando th:with -->
                    <div th:with="imagenPrincipal=${product.getImagenPrincipal()}, 
                                   isVideo=${imagenPrincipal != null ? (imagenPrincipal.isVideo != null ? imagenPrincipal.isVideo : false) : false}">
                        <!-- Video - Siempre presente pero oculto si no es video -->
                        <video th:if="${product.images != null and !product.images.isEmpty()}" 
                             th:src="${product.getImagenPrincipalUrl()}" 
                             id="mainVideo"
                             th:class="${isVideo} ? '' : 'd-none'"
                             autoplay muted loop
                             class="w-full h-full object-contain p-8 object-center group-hover:scale-105 transition-transform duration-700 ease-out"
                             style="background: white;"></video>
                        <!-- Imagen - Siempre presente pero oculto si es video -->
                        <img th:if="${product.images != null and !product.images.isEmpty()}" 
                             th:src="${product.getImagenPrincipalUrl()}" 
                             id="mainImage" 
                             th:class="${!isVideo and imagenPrincipal != null} ? '' : 'd-none'"
                             class="w-full h-full object-contain p-8 object-center group-hover:scale-105 transition-transform duration-700 ease-out"
                             alt="Product main view"/>
                    </div>
                    <button class="absolute top-5 right-5 bg-white/90 dark:bg-slate-800/90 p-3 rounded-full shadow-lg hover:text-red-500 transition-colors text-slate-400 hover:scale-110 active:scale-95 duration-200 z-10">
                        <span class="material-symbols-outlined block text-[24px]">favorite</span>
                    </button>
                </div>
                
                <!-- Thumbnails -->
                <div class="flex gap-4 overflow-x-auto no-scrollbar py-2" th:if="${product.images != null and product.images.size() > 1}">
                    <button th:each="image, iterStat : ${product.images}" 
                            th:class="${iterStat.first} ? 'shrink-0 w-24 h-24 rounded-2xl border-2 border-primary p-1 bg-white dark:bg-surface-dark overflow-hidden relative shadow-md transition-all thumbnail-vertical active' : 'shrink-0 w-24 h-24 rounded-2xl border border-slate-200 dark:border-slate-700 p-1 bg-white dark:bg-surface-dark overflow-hidden hover:border-slate-400 relative transition-all opacity-70 hover:opacity-100 thumbnail-vertical'"
                            th:data-image-url="${image.getImageUrl()}"
                            th:data-image-id="${image.id}"
                            th:data-is-video="${image.isVideo}"
                            class="thumbnail-vertical">
                        <!-- Mostrar video o imagen -->
                        <video th:if="${image.isVideo}" th:src="${image.getImageUrl()}" muted loop class="w-full h-full object-cover rounded-xl"></video>
                        <img th:unless="${image.isVideo}" th:src="${image.getThumbnailUrl()}" class="w-full h-full object-cover rounded-xl" alt="Product thumbnail"/>
                        <!-- Indicador de video -->
                        <div th:if="${image.isVideo}" class="absolute inset-0 bg-black/10 flex items-center justify-center z-10 transition-colors rounded-xl">
                            <div class="bg-white rounded-full p-1.5 shadow-md">
                                <span class="material-symbols-outlined text-primary text-[20px]">play_arrow</span>
                            </div>
                        </div>
                    </button>
                </div>
            </div>
            
            <!-- Product Info -->
            <div class="lg:col-span-5 relative">
                <div class="sticky top-28 flex flex-col gap-6">
                    <div>
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-primary font-bold text-xs tracking-widest uppercase bg-primary/10 px-2 py-1 rounded" 
                                  th:if="${product.categories != null and !product.categories.isEmpty()}" 
                                  th:text="${product.categories[0].name}">Categoría</span>
                            <div class="flex items-center gap-1.5 px-3 py-1 rounded-full bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400 text-xs font-bold border border-emerald-200 dark:border-emerald-800">
                                <span class="material-symbols-outlined text-[14px]">check_circle</span>
                                En Stock
                            </div>
                        </div>
                        <h1 class="text-slate-900 dark:text-white text-3xl md:text-4xl lg:text-[2.75rem] font-extrabold leading-tight mb-4 tracking-tight" th:text="${product.name}">
                            Nombre del Producto
                        </h1>
                        <div class="flex items-center gap-3 mb-2">
                            <div class="flex text-amber-400">
                                <span class="material-symbols-outlined fill-current text-[20px]">star</span>
                                <span class="material-symbols-outlined fill-current text-[20px]">star</span>
                                <span class="material-symbols-outlined fill-current text-[20px]">star</span>
                                <span class="material-symbols-outlined fill-current text-[20px]">star</span>
                                <span class="material-symbols-outlined fill-current text-[20px] text-slate-300 dark:text-slate-600">star_half</span>
                            </div>
                            <span class="text-sm text-slate-500 font-medium cursor-pointer hover:text-primary transition-colors border-b border-dashed border-slate-300 hover:border-primary">4.5 (128 reseñas)</span>
                        </div>
                    </div>
                    <div class="flex flex-wrap items-end gap-3 pb-6 border-b border-slate-100 dark:border-slate-800">
                        <span class="text-5xl font-black text-slate-900 dark:text-white tracking-tight" th:text="'$' + ${#numbers.formatDecimal(product.price, 0, 0)}">$0</span>
                        <span th:if="${product.etiquetaPromocional != null and !product.etiquetaPromocional.isEmpty()}" 
                              class="ml-auto bg-red-500 text-white text-sm font-bold px-3 py-1.5 rounded-lg shadow-sm transform -rotate-2" 
                              th:text="${product.etiquetaPromocional}">-20% OFF</span>
                    </div>
                    <p class="text-slate-600 dark:text-slate-300 text-base leading-relaxed" th:text="${product.descripcion ?: 'Producto de alta calidad con diseño único y materiales premium.'}">
                        Descripción del producto
                    </p>
                    
                    <!-- Colors -->
                    <div class="space-y-6 pt-2" th:if="${product.colores != null and product.colores.size() > 0}">
                        <div>
                            <span class="block text-sm font-bold text-slate-900 dark:text-white mb-3 flex items-center gap-2">
                                Color: <span class="font-medium text-slate-500" id="selectedColorName">Selecciona un color</span>
                            </span>
                            <div class="flex gap-4">
                                <button th:each="color : ${product.colores}" 
                                        th:title="${color.name}"
                                        th:attr="aria-label=${color.name},
                                                 style=${(color.imagePath != null and !color.imagePath.isEmpty()) ? 
                                                          ('background-image: url(/uploads/' + color.imagePath + '); background-size: cover; background-position: center;') : 
                                                          ('background-color: ' + (color.hexCode != null ? color.hexCode : '#6c757d') + ';')} + 'width: 44px; height: 44px; border-radius: 50%; border: 2px solid #e0e0e0; transition: all 0.3s ease;'"
                                        class="color-option hover:ring-2 hover:ring-offset-2 ring-slate-300 dark:ring-slate-600 dark:ring-offset-background-dark transition-all"
                                        th:data-color-name="${color.name}"></button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sizes - Solo para INDUMENTARIA -->
                    <div th:if="${product.tipoProducto != null and product.tipoProducto.name() == 'INDUMENTARIA' and product.talles != null and !product.talles.isEmpty()}">
                        <div class="flex justify-between items-center mb-3">
                            <span class="block text-sm font-bold text-slate-900 dark:text-white">Talle</span>
                        </div>
                        <div class="grid grid-cols-3 gap-3">
                            <button th:each="talle : ${product.talles}" 
                                    th:text="${talle.displayName}"
                                    class="px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 hover:border-slate-400 dark:hover:border-slate-500 text-slate-600 dark:text-slate-300 font-medium text-sm transition-all hover:bg-slate-50 dark:hover:bg-slate-800">
                                Talle
                            </button>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex flex-col gap-3 mt-4">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <button class="flex items-center justify-center gap-3 bg-[#25D366] hover:bg-[#20bd5a] text-white font-bold text-lg h-14 rounded-xl transition-all hover:-translate-y-0.5 active:translate-y-0 shadow-lg shadow-green-500/20 group"
                                    th:data-product-name="${product.name}"
                                    th:data-product-price="'$' + ${#numbers.formatDecimal(product.price, 0, 0)}">
                                <svg class="w-6 h-6 fill-current" viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7 .9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"></path></svg>
                                <span>Consultar WhatsApp</span>
                            </button>
                            <a th:href="@{/contact(producto=${product.name})}" class="flex items-center justify-center gap-3 bg-white dark:bg-surface-dark border-2 border-slate-200 dark:border-slate-700 hover:border-primary text-slate-900 dark:text-white font-bold text-lg h-14 rounded-xl transition-colors">
                                <span class="material-symbols-outlined">mail</span>
                                <span>Enviar Consulta</span>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Trust Indicators -->
                    <div class="grid grid-cols-2 gap-y-4 gap-x-2 pt-6 border-t border-slate-100 dark:border-slate-800 text-xs text-slate-500 dark:text-slate-400">
                        <div class="flex items-start gap-3">
                            <div class="p-1.5 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-primary">
                                <span class="material-symbols-outlined text-[18px] block">local_shipping</span>
                            </div>
                            <div>
                                <span class="block font-bold text-slate-700 dark:text-slate-200">Envío Gratis</span>
                                <span>A todo el país en compras &gt;$50</span>
                            </div>
                        </div>
                        <div class="flex items-start gap-3">
                            <div class="p-1.5 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-primary">
                                <span class="material-symbols-outlined text-[18px] block">verified_user</span>
                            </div>
                            <div>
                                <span class="block font-bold text-slate-700 dark:text-slate-200">Garantía Oficial</span>
                                <span>12 meses directos</span>
                            </div>
                        </div>
                        <div class="flex items-start gap-3">
                            <div class="p-1.5 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-primary">
                                <span class="material-symbols-outlined text-[18px] block">credit_card</span>
                            </div>
                            <div>
                                <span class="block font-bold text-slate-700 dark:text-slate-200">Pago Seguro</span>
                                <span>Todas las tarjetas</span>
                            </div>
                        </div>
                        <div class="flex items-start gap-3">
                            <div class="p-1.5 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-primary">
                                <span class="material-symbols-outlined text-[18px] block">headphones</span>
                            </div>
                            <div>
                                <span class="block font-bold text-slate-700 dark:text-slate-200">Soporte 24/7</span>
                                <span>Expertos disponibles</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tabs Section -->
        <div class="max-w-5xl mx-auto mb-24">
            <div class="border-b border-slate-200 dark:border-slate-800 mb-10 flex gap-10 overflow-x-auto no-scrollbar">
                <button onclick="showTab('description')" id="tab-description" class="pb-4 border-b-[3px] border-primary text-primary font-bold text-lg whitespace-nowrap tab-button tab-active">Descripción</button>
                <button onclick="showTab('specs')" id="tab-specs" class="pb-4 border-b-[3px] border-transparent text-slate-500 hover:text-slate-900 dark:hover:text-white font-medium text-lg transition-colors whitespace-nowrap tab-button">Especificaciones</button>
                <button onclick="showTab('care')" id="tab-care" class="pb-4 border-b-[3px] border-transparent text-slate-500 hover:text-slate-900 dark:hover:text-white font-medium text-lg transition-colors whitespace-nowrap tab-button" th:if="${product.cuidados != null and !product.cuidados.isEmpty()}">Cuidados</button>
            </div>
            <div class="space-y-16">
                <!-- Description Tab -->
                <section id="content-description" class="tab-content">
                    <h3 class="text-2xl font-bold mb-6 text-slate-900 dark:text-white" th:text="${product.name}">Descripción</h3>
                    <div class="prose prose-lg prose-slate dark:prose-invert max-w-none text-slate-600 dark:text-slate-300">
                        <p class="mb-4" th:text="${product.descripcion ?: 'Producto de alta calidad con diseño único y materiales premium. Perfecto para destacar tu personalidad y sentirte cómodo en cualquier ocasión.'}">
                            Descripción del producto
                        </p>
                    </div>
                </section>
                
                <!-- Specs Tab -->
                <section id="content-specs" class="tab-content hidden">
                    <div class="bg-white dark:bg-surface-dark rounded-2xl border border-slate-100 dark:border-slate-800 p-6 md:p-10 shadow-sm">
                        <div class="flex items-center gap-3 mb-8">
                            <div class="p-2 bg-slate-100 dark:bg-slate-800 rounded-lg">
                                <span class="material-symbols-outlined text-slate-700 dark:text-white">settings</span>
                            </div>
                            <h3 class="text-xl font-bold text-slate-900 dark:text-white">Especificaciones Técnicas</h3>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-y-6 gap-x-16">
                            <div th:if="${product.medidas}" class="flex justify-between items-center py-3 border-b border-slate-100 dark:border-slate-800">
                                <span class="text-slate-500 font-medium">Medidas</span>
                                <span class="text-slate-900 dark:text-white font-semibold" th:text="${product.medidas}"></span>
                            </div>
                            <div th:if="${product.material}" class="flex justify-between items-center py-3 border-b border-slate-100 dark:border-slate-800">
                                <span class="text-slate-500 font-medium">Material</span>
                                <span class="text-slate-900 dark:text-white font-semibold" th:text="${product.material}"></span>
                            </div>
                            <!-- Género - Solo para INDUMENTARIA -->
                            <div th:if="${product.tipoProducto != null and product.tipoProducto.name() == 'INDUMENTARIA' and product.generos != null and !product.generos.isEmpty()}" class="flex justify-between items-center py-3 border-b border-slate-100 dark:border-slate-800">
                                <span class="text-slate-500 font-medium">Género</span>
                                <span class="text-slate-900 dark:text-white font-semibold" th:text="${product.getGenerosComoTexto()}"></span>
                            </div>
                            <!-- Temporada - Solo para INDUMENTARIA -->
                            <div th:if="${product.tipoProducto != null and product.tipoProducto.name() == 'INDUMENTARIA' and product.temporadas != null and !product.temporadas.isEmpty()}" class="flex justify-between items-center py-3 border-b border-slate-100 dark:border-slate-800">
                                <span class="text-slate-500 font-medium">Temporada</span>
                                <span class="text-slate-900 dark:text-white font-semibold" th:text="${product.getTemporadasComoTexto()}"></span>
                            </div>
                            <div th:if="${product.edadRecomendada}" class="flex justify-between items-center py-3 border-b border-slate-100 dark:border-slate-800">
                                <span class="text-slate-500 font-medium">Edad Recomendada</span>
                                <span class="text-slate-900 dark:text-white font-semibold" th:text="${product.edadRecomendada}"></span>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Care Tab -->
                <section th:if="${product.cuidados != null and !product.cuidados.isEmpty()}" id="content-care" class="tab-content hidden">
                    <h3 class="text-xl font-bold mb-6 text-slate-900 dark:text-white">Cuidados</h3>
                    <div class="bg-white dark:bg-surface-dark rounded-2xl border border-slate-100 dark:border-slate-800 p-6 md:p-10 shadow-sm">
                        <p class="text-slate-600 dark:text-slate-300 leading-relaxed" th:text="${product.cuidados}">
                            Instrucciones de cuidado del producto
                        </p>
                    </div>
                </section>
            </div>
        </div>
    </main>
    
    <!-- Modal para imagen ampliada (PC) -->
    <div class="modal fade" id="imageModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content" style="background: transparent; border: none;">
                <div class="modal-header" style="border: none; padding: 0; position: absolute; top: 20px; right: 20px; z-index: 1050;">
                    <button type="button" class="btn-close btn-close-white modal-close-btn" data-bs-dismiss="modal" style="background: rgba(0,0,0,0.6); border-radius: 50%; padding: 12px; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease;"></button>
                </div>
                <div class="modal-body text-center" style="padding: 0; position: relative;">
                    <!-- Botón anterior (izquierda) -->
                    <button id="prevImageBtn" class="modal-nav-btn" style="position: absolute; left: 20px; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.6); color: white; border: none; border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 1051; font-size: 24px; transition: all 0.3s ease;">
                        <span class="material-symbols-outlined">chevron_left</span>
                    </button>
                    <!-- Botón siguiente (derecha) -->
                    <button id="nextImageBtn" class="modal-nav-btn" style="position: absolute; right: 20px; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.6); color: white; border: none; border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 1051; font-size: 24px; transition: all 0.3s ease;">
                        <span class="material-symbols-outlined">chevron_right</span>
                    </button>
                    <!-- Imagen del modal -->
                    <img id="modalImage" 
                         th:if="${product.images != null and !product.images.isEmpty()}" 
                         th:src="${product.images[0].getImageUrl()}" 
                         class="img-fluid modal-media" 
                         style="max-height: 90vh; max-width: 100%; object-fit: contain; background: white; border-radius: 10px; transition: all 0.3s ease;">
                    <!-- Video del modal (se crea dinámicamente si es necesario) -->
                    <video id="modalVideo" 
                           class="img-fluid d-none modal-media" 
                           autoplay muted loop controls
                           style="max-height: 90vh; max-width: 100%; object-fit: contain; background: black; border-radius: 10px;">
                    </video>
                    <!-- Indicadores de posición (puntos) -->
                    <div id="modalIndicators" class="modal-indicators" style="position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; z-index: 1051;">
                    </div>
                    <div th:if="${product.images == null or product.images.isEmpty()}" class="text-center py-5">
                        <span class="material-symbols-outlined" style="font-size: 5rem; color: white;">image</span>
                        <p class="text-white mt-3">Imagen no disponible</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="bg-white dark:bg-surface-dark border-t border-slate-200 dark:border-slate-800 pt-16 pb-8">
        <div class="max-w-7xl mx-auto px-4 md:px-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-12">
                <div class="flex flex-col gap-6">
                    <div class="flex items-center gap-3 text-slate-900 dark:text-white">
                        <div class="size-9 bg-primary rounded-xl flex items-center justify-center text-white shadow-lg shadow-primary/30">
                            <span class="material-symbols-outlined text-[20px]">shopping_bag</span>
                        </div>
                        <h2 class="text-xl font-bold tracking-tight">Detodoya</h2>
                    </div>
                    <p class="text-sm text-slate-500 dark:text-slate-400 leading-relaxed">
                        Tu tienda online de confianza para todo lo que necesitas. Calidad, rapidez y el mejor servicio al cliente garantizado.
                    </p>
                    <div class="flex gap-4">
                        <a class="size-10 flex items-center justify-center rounded-full bg-slate-100 dark:bg-slate-800 text-slate-500 hover:bg-primary hover:text-white transition-all" href="#"><span class="material-symbols-outlined text-[20px]">social_leaderboard</span></a>
                        <a class="size-10 flex items-center justify-center rounded-full bg-slate-100 dark:bg-slate-800 text-slate-500 hover:bg-primary hover:text-white transition-all" href="#"><span class="material-symbols-outlined text-[20px]">photo_camera</span></a>
                        <a class="size-10 flex items-center justify-center rounded-full bg-slate-100 dark:bg-slate-800 text-slate-500 hover:bg-primary hover:text-white transition-all" href="#"><span class="material-symbols-outlined text-[20px]">smart_display</span></a>
                    </div>
                </div>
                <div class="flex flex-col gap-4">
                    <h3 class="font-bold text-slate-900 dark:text-white text-base">Comprar</h3>
                    <div class="flex flex-col gap-3">
                        <a class="text-sm text-slate-500 dark:text-slate-400 hover:text-primary transition-colors" href="#">Novedades</a>
                        <a class="text-sm text-slate-500 dark:text-slate-400 hover:text-primary transition-colors" th:href="@{/catalog}">Catálogo</a>
                        <a class="text-sm text-slate-500 dark:text-slate-400 hover:text-primary transition-colors" href="#">Ofertas</a>
                    </div>
                </div>
                <div class="flex flex-col gap-4">
                    <h3 class="font-bold text-slate-900 dark:text-white text-base">Ayuda</h3>
                    <div class="flex flex-col gap-3">
                        <a class="text-sm text-slate-500 dark:text-slate-400 hover:text-primary transition-colors" th:href="@{/contact}">Contacto</a>
                        <a class="text-sm text-slate-500 dark:text-slate-400 hover:text-primary transition-colors" href="#">Preguntas Frecuentes</a>
                    </div>
                </div>
                <div class="flex flex-col gap-4">
                    <h3 class="font-bold text-slate-900 dark:text-white text-base">Suscríbete</h3>
                    <p class="text-sm text-slate-500 dark:text-slate-400">Recibe las últimas ofertas y novedades directamente en tu email.</p>
                    <div class="flex gap-2">
                        <input class="w-full rounded-lg border-none bg-slate-100 dark:bg-slate-800 px-4 py-2.5 text-sm focus:ring-2 ring-primary placeholder:text-slate-400" placeholder="Tu email" type="email"/>
                        <button class="bg-primary text-white rounded-lg px-5 py-2.5 text-sm font-bold hover:bg-primary-dark transition-colors shadow-md shadow-primary/20">Enviar</button>
                    </div>
                </div>
            </div>
            <div class="border-t border-slate-200 dark:border-slate-800 pt-8 flex flex-col md:flex-row justify-between items-center gap-6">
                <p class="text-sm text-slate-500 dark:text-slate-400">© 2024 Detodoya.com. Todos los derechos reservados.</p>
                <div class="flex gap-3">
                    <div class="h-8 w-12 bg-slate-100 dark:bg-slate-700 rounded border border-slate-200 dark:border-slate-600 flex items-center justify-center text-[10px] text-slate-400 font-bold">VISA</div>
                    <div class="h-8 w-12 bg-slate-100 dark:bg-slate-700 rounded border border-slate-200 dark:border-slate-600 flex items-center justify-center text-[10px] text-slate-400 font-bold">MC</div>
                    <div class="h-8 w-12 bg-slate-100 dark:bg-slate-700 rounded border border-slate-200 dark:border-slate-600 flex items-center justify-center text-[10px] text-slate-400 font-bold">PP</div>
                </div>
            </div>
        </div>
    </footer>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Variables para navegación del modal
        let currentModalImageIndex = 0;
        let modalImages = [];
        
        // Función para actualizar la lista de imágenes y videos del modal (incluye videos)
        function updateModalImagesList() {
            const thumbnails = document.querySelectorAll('.thumbnail-vertical');
            modalImages = [];
            thumbnails.forEach((thumb, index) => {
                const isVideo = thumb.getAttribute('data-is-video') === 'true';
                modalImages.push({
                    index: index,
                    url: thumb.getAttribute('data-image-url'),
                    isVideo: isVideo,
                    thumbnail: thumb
                });
            });
        }
        
        // Función para mostrar imagen o video en el modal
        function showModalImage(index) {
            if (modalImages.length === 0) return;
            if (index < 0) index = modalImages.length - 1;
            if (index >= modalImages.length) index = 0;
            
            currentModalImageIndex = index;
            const modalImage = document.getElementById('modalImage');
            const modalVideo = document.getElementById('modalVideo');
            const modalBody = document.querySelector('#imageModal .modal-body');
            
            if (modalImages[index]) {
                const item = modalImages[index];
                
                if (item.isVideo) {
                    // Es un video
                    if (modalVideo) {
                        modalVideo.src = item.url;
                        modalVideo.classList.remove('d-none');
                    } else {
                        const video = document.createElement('video');
                        video.id = 'modalVideo';
                        video.className = 'img-fluid modal-media';
                        video.autoplay = true;
                        video.muted = true;
                        video.loop = true;
                        video.controls = true;
                        video.style.cssText = 'max-height: 90vh; max-width: 100%; object-fit: contain; background: black; border-radius: 10px; transition: all 0.3s ease;';
                        video.src = item.url;
                        if (modalBody) {
                            modalBody.insertBefore(video, modalImage);
                        }
                    }
                    if (modalImage) {
                        modalImage.classList.add('d-none');
                    }
                } else {
                    // Es una imagen
                    if (modalImage) {
                        modalImage.src = item.url;
                        modalImage.classList.remove('d-none');
                    }
                    if (modalVideo) {
                        modalVideo.classList.add('d-none');
                    }
                }
            }
            
            // Actualizar thumbnails activos
            document.querySelectorAll('.thumbnail-vertical').forEach(t => {
                t.classList.remove('active', 'border-primary', 'border-2');
                t.classList.add('border-slate-200', 'border');
            });
            if (modalImages[index] && modalImages[index].thumbnail) {
                modalImages[index].thumbnail.classList.add('active', 'border-primary', 'border-2');
                modalImages[index].thumbnail.classList.remove('border-slate-200');
            }
            
            // Actualizar indicadores
            updateModalIndicators();
        }
        
        // Función para actualizar los indicadores del modal
        function updateModalIndicators() {
            const indicatorsContainer = document.getElementById('modalIndicators');
            if (!indicatorsContainer || modalImages.length <= 1) {
                if (indicatorsContainer) indicatorsContainer.style.display = 'none';
                return;
            }
            
            indicatorsContainer.style.display = 'flex';
            indicatorsContainer.innerHTML = '';
            
            modalImages.forEach((img, index) => {
                const indicator = document.createElement('span');
                indicator.className = 'modal-indicator';
                indicator.style.cssText = `
                    width: 10px;
                    height: 10px;
                    border-radius: 50%;
                    background: ${index === currentModalImageIndex ? 'rgba(255,255,255,1)' : 'rgba(255,255,255,0.5)'};
                    cursor: pointer;
                    transition: all 0.3s ease;
                `;
                if (index === currentModalImageIndex) {
                    indicator.style.transform = 'scale(1.3)';
                }
                indicator.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showModalImage(index);
                });
                indicator.addEventListener('mouseenter', () => {
                    if (index !== currentModalImageIndex) {
                        indicator.style.background = 'rgba(255,255,255,0.8)';
                    }
                });
                indicator.addEventListener('mouseleave', () => {
                    if (index !== currentModalImageIndex) {
                        indicator.style.background = 'rgba(255,255,255,0.5)';
                    }
                });
                indicatorsContainer.appendChild(indicator);
            });
        }
        
        // Función para imagen anterior en el modal
        function prevModalImage() {
            if (modalImages.length === 0) return;
            const newIndex = (currentModalImageIndex - 1 + modalImages.length) % modalImages.length;
            showModalImage(newIndex);
        }
        
        // Función para imagen siguiente en el modal
        function nextModalImage() {
            if (modalImages.length === 0) return;
            const newIndex = (currentModalImageIndex + 1) % modalImages.length;
            showModalImage(newIndex);
        }
        
        // Tabs functionality
        function showTab(tabName) {
            // Ocultar todos los contenidos
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remover active de todos los botones
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('tab-active', 'border-primary', 'text-primary', 'font-bold');
                btn.classList.add('border-transparent', 'text-slate-500', 'font-medium');
            });
            
            // Mostrar el contenido seleccionado
            const content = document.getElementById('content-' + tabName);
            if (content) {
                content.classList.remove('hidden');
            }
            
            // Activar el botón seleccionado
            const button = document.getElementById('tab-' + tabName);
            if (button) {
                button.classList.add('tab-active', 'border-primary', 'text-primary', 'font-bold');
                button.classList.remove('border-transparent', 'text-slate-500', 'font-medium');
            }
        }
        
        // WhatsApp function
        function openWhatsApp(productName, productPrice) {
            const message = encodeURIComponent(`Hola! Me interesa conocer más sobre: ${productName} - ${productPrice}`);
            window.open(`https://wa.me/5491168570940?text=${message}`, '_blank');
        }
        
        // Inicialización cuando el DOM está listo
        document.addEventListener('DOMContentLoaded', function() {
            // Actualizar lista de imágenes del modal
            updateModalImagesList();
            
            // Cambio de thumbnails interactivos
            document.querySelectorAll('.thumbnail-vertical').forEach(thumb => {
                thumb.addEventListener('click', function() {
                    // Remover clase active de todos los thumbnails
                    document.querySelectorAll('.thumbnail-vertical').forEach(t => {
                        t.classList.remove('active', 'border-primary', 'border-2');
                        t.classList.add('border-slate-200', 'border');
                    });
                    // Agregar clase active al thumbnail clickeado
                    this.classList.add('active', 'border-primary', 'border-2');
                    this.classList.remove('border-slate-200');
                    
                    // Obtener URL de la imagen de alta calidad
                    const imageUrl = this.getAttribute('data-image-url');
                    const isVideo = this.getAttribute('data-is-video') === 'true';
                    const imageIndex = Array.from(document.querySelectorAll('.thumbnail-vertical')).indexOf(this);
                    
                    if (imageUrl) {
                        const mainImage = document.getElementById('mainImage');
                        const mainVideo = document.getElementById('mainVideo');
                        const mainContainer = document.getElementById('mainImageContainer');
                        
                        if (isVideo) {
                            // Es un video
                            if (mainVideo) {
                                mainVideo.src = imageUrl;
                                mainVideo.classList.remove('d-none');
                            }
                            if (mainImage) {
                                mainImage.classList.add('d-none');
                            }
                        } else {
                            // Es una imagen
                            if (mainImage) {
                                mainImage.src = imageUrl;
                                mainImage.classList.remove('d-none');
                            }
                            if (mainVideo) {
                                mainVideo.classList.add('d-none');
                            }
                        }
                        
                        // Actualizar índice del modal
                        const imgIndex = modalImages.findIndex(img => img.index === imageIndex);
                        if (imgIndex !== -1) {
                            currentModalImageIndex = imgIndex;
                        }
                    }
                });
            });
            
            // Botones de navegación del modal
            const prevBtn = document.getElementById('prevImageBtn');
            const nextBtn = document.getElementById('nextImageBtn');
            
            if (prevBtn) {
                prevBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    prevModalImage();
                });
            }
            
            if (nextBtn) {
                nextBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    nextModalImage();
                });
            }
            
            // Navegación con teclado en el modal
            document.addEventListener('keydown', function(e) {
                const modal = document.getElementById('imageModal');
                if (modal && modal.classList.contains('show')) {
                    if (e.key === 'ArrowLeft') {
                        e.preventDefault();
                        prevModalImage();
                    } else if (e.key === 'ArrowRight') {
                        e.preventDefault();
                        nextModalImage();
                    } else if (e.key === 'Escape') {
                        const modalInstance = bootstrap.Modal.getInstance(modal);
                        if (modalInstance) {
                            modalInstance.hide();
                        }
                    }
                }
            });
            
            // Evento cuando se abre el modal
            const imageModal = document.getElementById('imageModal');
            if (imageModal) {
                imageModal.addEventListener('show.bs.modal', function() {
                    const activeThumbnail = document.querySelector('.thumbnail-vertical.active');
                    
                    if (activeThumbnail && modalImages.length > 0) {
                        const allThumbnails = document.querySelectorAll('.thumbnail-vertical');
                        const activeIndex = Array.from(allThumbnails).indexOf(activeThumbnail);
                        const imgIndex = modalImages.findIndex(img => img.index === activeIndex);
                        
                        if (imgIndex !== -1) {
                            showModalImage(imgIndex);
                        } else if (modalImages.length > 0) {
                            showModalImage(0);
                        }
                    } else if (modalImages.length > 0) {
                        if (currentModalImageIndex >= 0 && currentModalImageIndex < modalImages.length) {
                            showModalImage(currentModalImageIndex);
                        } else {
                            showModalImage(0);
                        }
                    }
                });
            }
            
            // Ocultar botones de navegación si solo hay una imagen
            if (modalImages.length <= 1) {
                const navButtons = document.querySelectorAll('.modal-nav-btn');
                navButtons.forEach(btn => {
                    if (btn) btn.style.display = 'none';
                });
            }
            
            // Mejorar estilos de botones del modal
            document.querySelectorAll('.modal-nav-btn').forEach(btn => {
                btn.addEventListener('mouseenter', function() {
                    this.style.background = 'rgba(0,0,0,0.8)';
                    this.style.transform = 'translateY(-50%) scale(1.1)';
                });
                btn.addEventListener('mouseleave', function() {
                    this.style.background = 'rgba(0,0,0,0.6)';
                    this.style.transform = 'translateY(-50%) scale(1)';
                });
            });
            
            // Mejorar estilo del botón de cerrar
            const closeBtn = document.querySelector('.modal-close-btn');
            if (closeBtn) {
                closeBtn.addEventListener('mouseenter', function() {
                    this.style.background = 'rgba(0,0,0,0.8)';
                    this.style.transform = 'scale(1.1)';
                });
                closeBtn.addEventListener('mouseleave', function() {
                    this.style.background = 'rgba(0,0,0,0.6)';
                    this.style.transform = 'scale(1)';
                });
            }
            
            // Botones de WhatsApp
            document.querySelectorAll('button[data-product-name]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productName = this.getAttribute('data-product-name');
                    const productPrice = this.getAttribute('data-product-price');
                    openWhatsApp(productName, productPrice);
                });
            });
            
            // Color selection
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', function() {
                    const colorName = this.getAttribute('data-color-name');
                    if (colorName) {
                        document.getElementById('selectedColorName').textContent = colorName;
                        // Remover selección anterior
                        document.querySelectorAll('.color-option').forEach(opt => {
                            opt.style.border = '2px solid #e0e0e0';
                        });
                        // Resaltar el color seleccionado
                        this.style.border = '4px solid #137fec';
                    }
                });
            });
            
            // Click en imagen principal para abrir modal
            const mainImageContainer = document.getElementById('mainImageContainer');
            if (mainImageContainer) {
                mainImageContainer.addEventListener('click', function() {
                    // En móvil, usar el carrusel de pantalla completa
                    if (window.innerWidth <= 768) {
                        openFullscreenCarousel();
                    } else {
                        // En PC, usar el modal de Bootstrap
                        const modal = new bootstrap.Modal(document.getElementById('imageModal'));
                        modal.show();
                    }
                });
            }
        });
        
        // Variables para el carrusel en pantalla completa (móvil)
        let fullscreenCarouselIndex = 0;
        let fullscreenCarouselModal = null;
        let fullscreenTouchStartX = 0;
        let fullscreenTouchEndX = 0;
        
        // Función para abrir carrusel en pantalla completa (móvil)
        function openFullscreenCarousel() {
            if (modalImages.length === 0) return;
            
            // Usar el índice actual de la imagen
            fullscreenCarouselIndex = currentModalImageIndex;
            
            // Crear modal de zoom con carrusel
            fullscreenCarouselModal = document.createElement('div');
            fullscreenCarouselModal.className = 'mobile-zoom-modal';
            fullscreenCarouselModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.95);
                z-index: 9999;
                display: flex;
                align-items: center;
                justify-content: center;
                overflow: hidden;
                touch-action: pan-y;
                animation: fadeIn 0.3s ease;
            `;
            
            // Contenedor del carrusel
            const carouselContainer = document.createElement('div');
            carouselContainer.className = 'fullscreen-carousel-container';
            carouselContainer.style.cssText = `
                position: relative;
                width: 100%;
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
                overflow: hidden;
            `;
            
            // Contenedor de imágenes/videos con transform para el carrusel
            const carouselTrack = document.createElement('div');
            carouselTrack.className = 'fullscreen-carousel-track';
            carouselTrack.style.cssText = `
                display: flex;
                width: 100%;
                height: 100%;
                position: relative;
                transition: transform 0.3s ease;
            `;
            
            // Crear slides para cada imagen/video
            modalImages.forEach((item, index) => {
                const slide = document.createElement('div');
                slide.className = 'fullscreen-carousel-slide';
                slide.style.cssText = `
                    min-width: 100%;
                    width: 100%;
                    height: 100%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    position: relative;
                `;
                
                if (item.isVideo) {
                    const video = document.createElement('video');
                    video.src = item.url;
                    video.autoplay = true;
                    video.muted = true;
                    video.loop = true;
                    video.controls = true;
                    video.style.cssText = `
                        max-width: 90%;
                        max-height: 90%;
                        width: auto;
                        height: auto;
                        object-fit: contain;
                    `;
                    slide.appendChild(video);
                } else {
                    const img = document.createElement('img');
                    img.src = item.url;
                    img.style.cssText = `
                        max-width: 90%;
                        max-height: 90%;
                        width: auto;
                        height: auto;
                        object-fit: contain;
                    `;
                    slide.appendChild(img);
                }
                
                carouselTrack.appendChild(slide);
            });
            
            carouselContainer.appendChild(carouselTrack);
            
            // Indicadores de posición (puntos)
            if (modalImages.length > 1) {
                const indicatorsContainer = document.createElement('div');
                indicatorsContainer.className = 'fullscreen-carousel-indicators';
                indicatorsContainer.style.cssText = `
                    position: absolute;
                    bottom: 30px;
                    left: 50%;
                    transform: translateX(-50%);
                    display: flex;
                    gap: 10px;
                    z-index: 10000;
                `;
                
                modalImages.forEach((item, index) => {
                    const indicator = document.createElement('span');
                    indicator.className = 'fullscreen-carousel-indicator';
                    if (index === fullscreenCarouselIndex) {
                        indicator.classList.add('active');
                    }
                    indicator.style.cssText = `
                        width: 10px;
                        height: 10px;
                        border-radius: 50%;
                        background: ${index === fullscreenCarouselIndex ? 'rgba(255,255,255,1)' : 'rgba(255,255,255,0.5)'};
                        cursor: pointer;
                        transition: all 0.3s ease;
                    `;
                    indicator.addEventListener('click', (e) => {
                        e.stopPropagation();
                        goToFullscreenImage(index);
                    });
                    indicatorsContainer.appendChild(indicator);
                });
                
                carouselContainer.appendChild(indicatorsContainer);
            }
            
            // Botón de cerrar
            const closeBtn = document.createElement('button');
            closeBtn.innerHTML = '<span class="material-symbols-outlined">close</span>';
            closeBtn.style.cssText = `
                position: absolute;
                top: 20px;
                right: 20px;
                width: 45px;
                height: 45px;
                background: rgba(0,0,0,0.6);
                color: white;
                border: none;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                z-index: 10000;
                font-size: 20px;
                transition: all 0.3s ease;
            `;
            closeBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                closeFullscreenCarousel();
            });
            closeBtn.addEventListener('mouseenter', () => {
                closeBtn.style.background = 'rgba(0,0,0,0.8)';
                closeBtn.style.transform = 'scale(1.1)';
            });
            closeBtn.addEventListener('mouseleave', () => {
                closeBtn.style.background = 'rgba(0,0,0,0.6)';
                closeBtn.style.transform = 'scale(1)';
            });
            
            carouselContainer.appendChild(closeBtn);
            
            fullscreenCarouselModal.appendChild(carouselContainer);
            document.body.appendChild(fullscreenCarouselModal);
            
            // Prevenir scroll del body
            document.body.classList.add('carousel-open');
            document.body.style.overflow = 'hidden';
            
            // Actualizar posición inicial
            updateFullscreenCarouselPosition();
            
            // Eventos de touch para swipe
            carouselTrack.addEventListener('touchstart', (e) => {
                fullscreenTouchStartX = e.touches[0].clientX;
                carouselTrack.style.transition = 'none';
            }, { passive: true });
            
            carouselTrack.addEventListener('touchmove', (e) => {
                if (fullscreenTouchStartX === 0) return;
                const currentX = e.touches[0].clientX;
                const diff = currentX - fullscreenTouchStartX;
                const translateX = -(fullscreenCarouselIndex * 100) + (diff / window.innerWidth * 100);
                carouselTrack.style.transform = `translateX(${translateX}%)`;
            }, { passive: true });
            
            carouselTrack.addEventListener('touchend', (e) => {
                if (fullscreenTouchStartX === 0) return;
                
                fullscreenTouchEndX = e.changedTouches[0].clientX;
                const diff = fullscreenTouchStartX - fullscreenTouchEndX;
                const swipeThreshold = 50;
                
                carouselTrack.style.transition = 'transform 0.3s ease';
                
                if (Math.abs(diff) > swipeThreshold) {
                    if (diff > 0) {
                        nextFullscreenImage();
                    } else {
                        prevFullscreenImage();
                    }
                } else {
                    updateFullscreenCarouselPosition();
                }
                
                fullscreenTouchStartX = 0;
            }, { passive: true });
            
            // Prevenir el cierre al hacer clic en el contenido
            carouselContainer.addEventListener('click', (e) => {
                e.stopPropagation();
            });
            
            // Cerrar al hacer clic en el fondo
            fullscreenCarouselModal.addEventListener('click', (e) => {
                if (e.target === fullscreenCarouselModal) {
                    closeFullscreenCarousel();
                }
            });
        }
        
        // Función para actualizar posición del carrusel en pantalla completa
        function updateFullscreenCarouselPosition() {
            if (!fullscreenCarouselModal) return;
            const carouselTrack = fullscreenCarouselModal.querySelector('.fullscreen-carousel-track');
            if (carouselTrack) {
                carouselTrack.style.transform = `translateX(-${fullscreenCarouselIndex * 100}%)`;
            }
            
            // Actualizar indicadores
            const indicators = fullscreenCarouselModal.querySelectorAll('.fullscreen-carousel-indicator');
            indicators.forEach((indicator, index) => {
                if (index === fullscreenCarouselIndex) {
                    indicator.classList.add('active');
                    indicator.style.background = 'rgba(255,255,255,1)';
                    indicator.style.transform = 'scale(1.3)';
                } else {
                    indicator.classList.remove('active');
                    indicator.style.background = 'rgba(255,255,255,0.5)';
                    indicator.style.transform = 'scale(1)';
                }
            });
        }
        
        // Función para siguiente imagen en pantalla completa
        function nextFullscreenImage() {
            if (modalImages.length === 0) return;
            fullscreenCarouselIndex = (fullscreenCarouselIndex + 1) % modalImages.length;
            updateFullscreenCarouselPosition();
        }
        
        // Función para imagen anterior en pantalla completa
        function prevFullscreenImage() {
            if (modalImages.length === 0) return;
            fullscreenCarouselIndex = fullscreenCarouselIndex === 0 ? modalImages.length - 1 : fullscreenCarouselIndex - 1;
            updateFullscreenCarouselPosition();
        }
        
        // Función para ir a una imagen específica en pantalla completa
        function goToFullscreenImage(index) {
            if (index >= 0 && index < modalImages.length) {
                fullscreenCarouselIndex = index;
                updateFullscreenCarouselPosition();
            }
        }
        
        // Función para cerrar el carrusel en pantalla completa
        function closeFullscreenCarousel() {
            if (fullscreenCarouselModal && document.body.contains(fullscreenCarouselModal)) {
                document.body.removeChild(fullscreenCarouselModal);
                fullscreenCarouselModal = null;
                document.body.classList.remove('carousel-open');
                document.body.style.overflow = '';
            }
        }
        
        // Agregar animación fadeIn
        if (!document.querySelector('#fadeInAnimation')) {
            const style = document.createElement('style');
            style.id = 'fadeInAnimation';
            style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                
                body.carousel-open {
                    overflow: hidden;
                    position: fixed;
                    width: 100%;
                }
            `;
            document.head.appendChild(style);
        }
    </script>
</body>
</html>
